# -*- mode: python; -*-
# This Python script, SConscript, invoked by the SConscript in the upper directory,
#
# 1. builds libmalaria.dll to handle malaria disease based on libgeneric_static.lib and libvector_static.lib

Import('env')

stdobj = env.Object("stdafx.cpp")

libhivartstagingbycd4diagnosticdllSrcFiles = [
                                                       "../../interventions/HIVARTStagingByCD4Diagnostic.cpp",
                                                       "../../interventions/HIVARTStagingByCD4DiagnosticEModule.cpp"
                                                   ]

libhivartstagingbycd4diagnosticdllIncFiles = [  "../../interventions/hivartstagingbycd4diagnostic.h" ]
libhivartstagingbycd4diagnosticdllLocalInc = [  "stdafx.h" ]

hivartstagingbycd4diagnosticenv = env.Clone()
abs_obj = hivartstagingbycd4diagnosticenv.Object( "hasbcd_base", "../../interventions/HIVARTStagingAbstract.cpp" )
hsd_obj = hivartstagingbycd4diagnosticenv.Object( "hasbcd_hsd", "../../interventions/HIVSimpleDiagnostic.cpp" )
sd_obj =  hivartstagingbycd4diagnosticenv.Object( "hasbcd_sd", "../../interventions/Diagnostics.cpp" )

hivartstagingbycd4diagnosticenv.Append(LIBS=['libgeneric_static'])
hivartstagingbycd4diagnosticenv.Append(LIBPATH=['$BUILD_DIR/libgeneric_static'])
hivartstagingbycd4diagnosticenv.Append(LIBS=['libsti_static'])
hivartstagingbycd4diagnosticenv.Append(LIBPATH=['$BUILD_DIR/libgeneric'])

libhivartstagingbycd4diagnosticDll = hivartstagingbycd4diagnosticenv.SharedLibrary('libhivartstagingbycd4diagnostic', libhivartstagingbycd4diagnosticdllSrcFiles + stdobj + abs_obj + hsd_obj + sd_obj )
#print "building libhivartstagingbycd4diagnosticdll: " + str(libhivartstagingbycd4diagnosticdll)

# take libhivartstagingbycd4diagnostic.dll (exclude .lib, .exp) out to be the building target
# to match the number of building variant
libhivartstagingbycd4diagnosticdllTarget = libhivartstagingbycd4diagnosticDll[0]

msvc = GetOption( "MSVC" )
if msvc is not None and msvc != False and msvc != "":

    bvar = hivartstagingbycd4diagnosticenv['BUILD_VARIANT'] + '|x64'
    print str(libhivartstagingbycd4diagnosticdllTarget) + ": Generating MSVS" + hivartstagingbycd4diagnosticenv['MSVS_VERSION'] + " project files for '%s'" % bvar
    
    hivartstagingbycd4diagnosticenv.MSVSProject(target = 'Libhivartstagingbycd4diagnosticdllScons' + hivartstagingbycd4diagnosticenv['MSVSPROJECTSUFFIX'],
                    srcs = libhivartstagingbycd4diagnosticdllSrcFiles,
		    incs = libhivartstagingbycd4diagnosticdllIncFiles,
		    localincs = libhivartstagingbycd4diagnosticdllLocalInc,
 		    buildtarget = libhivartstagingbycd4diagnosticdllTarget,
                    auto_build_solution = 0,
                    variant = bvar)
