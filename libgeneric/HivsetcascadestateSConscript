# -*- mode: python; -*-
# This Python script, SConscript, invoked by the SConscript in the upper directory,
#
# 1. builds libmalaria.dll to handle malaria disease based on libgeneric_static.lib and libvector_static.lib

Import('env')

stdobj = env.Object("stdafx.cpp")

libhivsetcascadestatedllSrcFiles = [ "../../interventions/HIVSetCascadeState.cpp",
                         "../../interventions/HIVSetCascadeStateEModule.cpp"
                         ]

libhivsetcascadestatedllIncFiles = [  "../../interventions/hivsetcascadestate.h" ]
libhivsetcascadestatedllLocalInc = [  "stdafx.h" ]

hivsetcascadestateenv = env.Clone()
hsd_obj = hivsetcascadestateenv.Object( "hscs_hsd", "../../interventions/HIVSimpleDiagnostic.cpp" )
sd_obj  = hivsetcascadestateenv.Object( "hscs_sd",  "../../interventions/Diagnostics.cpp" )
hivsetcascadestateenv.Append(LIBS=['libgeneric_static'])
hivsetcascadestateenv.Append(LIBPATH=['$BUILD_DIR/libgeneric_static'])
hivsetcascadestateenv.Append(LIBPATH=['$BUILD_DIR/libgeneric'])

libhivsetcascadestateDll = hivsetcascadestateenv.SharedLibrary('libhivsetcascadestate', libhivsetcascadestatedllSrcFiles + stdobj + hsd_obj + sd_obj )
#print "building libhivsetcascadestatedll: " + str(libhivsetcascadestatedll)

# take libhivsetcascadestate.dll (exclude .lib, .exp) out to be the building target
# to match the number of building variant
libhivsetcascadestatedllTarget = libhivsetcascadestateDll[0]

msvc = GetOption( "MSVC" )
if msvc is not None and msvc != False and msvc != "":

    bvar = hivsetcascadestateenv['BUILD_VARIANT'] + '|x64'
    print str(libhivsetcascadestatedllTarget) + ": Generating MSVS" + hivsetcascadestateenv['MSVS_VERSION'] + " project files for '%s'" % bvar
    
    hivsetcascadestateenv.MSVSProject(target = 'LibhivsetcascadestatedllScons' + hivsetcascadestateenv['MSVSPROJECTSUFFIX'],
                    srcs = libhivsetcascadestatedllSrcFiles,
		    incs = libhivsetcascadestatedllIncFiles,
		    localincs = libhivsetcascadestatedllLocalInc,
 		    buildtarget = libhivsetcascadestatedllTarget,
                    auto_build_solution = 0,
                    variant = bvar)
