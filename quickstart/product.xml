<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="AAB83AD8-6CC7-47BD-8113-588FF1A250F4" Name="EMOD QuickStart" Language="1033" Version="2.0.0.0" Manufacturer="Institute for Disease Modeling" UpgradeCode="0FC681A1-91BE-4E32-9FA7-C36869526F62">
    <Package Id="*" InstallerVersion="405" Compressed="yes" InstallScope="perMachine" Keywords="Installer" Description="EMOD QuickStart Installer" Manufacturer="Institute for Disease Modeling" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <Condition Message="This application is only supported on 64-bit Windows 7 or higher.">
        <![CDATA[Installed OR (VersionNT64 >= 601)]]>
    </Condition>

    <UIRef Id="IdmWixUI_Minimal" />
    <UIRef Id="WixUI_ErrorProgressText" />

    <Feature Id="ProductFeature" Title="QuickStart" Level="1">
      <ComponentGroupRef Id="ExecutableComponents" />
    </Feature>
    <Feature Id="SampleScenarios" Title="Samples" Level="1">
      <ComponentGroupRef Id="SamplesComponents" />
    </Feature>
    <Feature Id="InputFiles" Title="Input Files for Samples" Level="1">
      <ComponentRef Id="InputFilesComponent" />
    </Feature>

    <Feature Id="VCRedist" Title="Visual C++ Runtime" AllowAdvertise="no" Display="hidden" Level="1">
      <MergeRef Id="VCRedist" />
    </Feature>

    <WixVariable Id="WixUILicenseRtf" Value="IdmEula.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="banner.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="dialog.bmp" />

    <Icon Id="icon.ico" SourceFile="DtkQuickStart.ico"/>
    <Property Id="ARPPRODUCTICON" Value="icon.ico" />

    <Property Id='NOTEPAD'>Notepad.exe</Property>
    <CustomAction Id='LaunchFile' Property='NOTEPAD' ExeCommand='[INSTALLFOLDER]ReadMe.txt' Return='asyncNoWait' />

    <InstallExecuteSequence>
      <Custom Action='LaunchFile' After='InstallFinalize'>NOT Installed</Custom>
    </InstallExecuteSequence>
  </Product>

  <Fragment>
    <ComponentGroup Id="ExecutableComponents">
      <ComponentRef Id="ExecutableComponent" />
      <ComponentRef Id="CustomReporters" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="ScenarioFolder" />
      <ComponentRef Id="BinaryPath" />
      <ComponentRef Id="EmodPath" />
      <ComponentRef Id="ScriptPath" />
    </ComponentGroup>
  </Fragment>
  
  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="LocalAppDataFolder">
        <Directory Id="EmodDirectory" Name="EMOD">
          <Directory Id="QuickStart" Name="QuickStart" >
            <Directory Id="INSTALLFOLDER" Name="v2.0.0">
              <Component Id="ExecutableComponent" Guid="01B86E5A-6240-4744-B80B-74B22919A06E" Win64="yes">
                <CreateFolder />
                <RemoveFolder Id="RemoveInstallFolder" On="uninstall" />
                <RemoveFolder Id="RemoveQuickStartFolder" Directory="QuickStart" On="uninstall" />
                <RemoveFolder Id="RemoveEmodFolder" Directory="EmodDirectory" On="uninstall" />
                <RegistryKey Root="HKCU" Key="Software\EMOD\QuickStart\2.0.0">
                  <RegistryValue Name="Executable" Value="1" KeyPath="yes" Type="integer" />
                </RegistryKey>
                <File Source="$(var.Eradication.TargetPath)" />
                <File Source="ReadMe.txt" />
              </Component>
              <Component Id="BinaryPath" Guid="{3F4C6976-3F36-43B1-BD71-C2070EBA2475}">
                <Environment Id="BinaryPath" Name="PATH" Value="[INSTALLFOLDER]" Permanent="no" Part="last" Action="set" System="no" />
                <RegistryKey Root="HKCU" Key="Software\EMOD\QuickStart\2.0.0">
                  <RegistryValue Name="BinaryPath" Value="1" KeyPath="yes" Type="integer" />
                </RegistryKey>
              </Component>
              <Component Id="EmodPath" Guid="26FCFA29-454F-4451-BC9B-26301CC93ED2">
                <Environment Id="EmodPath" Name="EMODPATH" Value="[INSTALLFOLDER]" Permanent="no" Part="all" Action="set" System="no" />
                <RegistryKey Root="HKCU" Key="Software\EMOD\QuickStart\2.0.0">
                  <RegistryValue Name="EmodPath" Value="1" KeyPath="yes" Type="integer" />
                </RegistryKey>
              </Component>
              <Component Id="ScriptPath" Guid="{DC0560C5-F1C3-4BC1-973A-A9D228525A30}">
                <Environment Id="ScriptPath" Name="PATH" Value="[SCENARIOSFOLDER]Scripts" Permanent="no" Part="last" Action="set" System="no" />
                <RegistryKey Root="HKCU" Key="Software\EMOD\QuickStart\2.0.0">
                  <RegistryValue Name="ScriptPath" Value="1" KeyPath="yes" Type="integer" />
                </RegistryKey>
              </Component>
              <Directory Id="REPORTSFOLDER" Name="reporter_plugins">
                <Component Id="CustomReporters" Guid="DAF4CDC2-599C-4C20-8CC6-87653C4B2FE1" Win64="yes">
                  <CreateFolder />
                  <RemoveFolder Id="RemoveReporterFolder" On="uninstall" />
                  <RegistryKey Root="HKCU" Key="Software\EMOD\QuickStart\2.0.0">
                    <RegistryValue Name="Reporters" Value="1" KeyPath="yes" Type="integer" />
                  </RegistryKey>
                  <File Source="$(var.SolutionDir)..\x64\Release\reporter_plugins\lib_custom_tb_reporter_Scenarios.dll" />
                </Component>
              </Directory>
              <Directory Id="SCENARIOSFOLDER" Name="Scenarios">
                <SamplesComponent/>
                <Directory Id="INPUTFILESFOLDER" Name="InputFiles">
                  <Component Id="InputFilesComponent" Guid="{61CE9111-C91B-4E01-BA92-76726B8D791B}" >
                    <InputFilesComponent/>
                  </Component>
                </Directory>
              </Directory>
            </Directory>
          </Directory>
        </Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="EMOD QuickStart">
          <Component Id="ApplicationShortcut" Guid="{362AF075-6F16-4634-A777-F52C18E8C618}">
            <Shortcut Id="ApplicationStartMenuShortcut"
                      Name="EMOD QuickStart"
                      Description="My Application Description"
                      Target="[System64Folder]\cmd.exe"
                      WorkingDirectory="INSTALLFOLDER"/>
            <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
              <RegistryValue Root="HKCU" Key="Software\EMOD\QuickStart\2.0.0" Name="commandshortcut" Type="integer" Value="1" KeyPath="yes"/>
          </Component>
          <Component Id="ScenarioFolder" Guid="{989CE0C1-579B-4E26-88A5-60DB73D15B8E}">
            <Shortcut Id="ScenarioFolderShortbut"
                      Name="EMOD Scenarios"
                      Description="Start Menu Shortcut to EMOD Scenarios Directory"
                      Target="[SCENARIOSFOLDER]"
                      WorkingDirectory="SCENARIOSFOLDER"/>
            <RemoveFolder Id="ApplicationProgramsFilder" On="uninstall"/>
            <RegistryValue Root="HKCU" Key="Software\EMOD\QuickStart\2.0.0" Name="foldershortcut" Type="integer" Value="1" KeyPath="yes"/>
          </Component>
        </Directory>
      </Directory>
      <Merge Id="VCRedist" SourceFile="C:\Program Files (x86)\Common Files\Merge Modules\Microsoft_VC110_CRT_x64.msm" DiskId="1" Language="0" />
    </Directory>
  </Fragment>
  <SamplesComponentGroup/>
</Wix>
